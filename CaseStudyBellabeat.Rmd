---
title: "Case Study Bellabeat"
author: "Alfred Chan" 
date: "2024-03-18"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  comment = NA,
  warning = FALSE, 
  message = FALSE
)
```
```{css, echo = FALSE}
body {
  counter-reset: counter-rchunks;
}

div.main-container {
  padding-left: 5em;
}

pre.r {
  counter-increment: counter-rchunks;
  position: relative;
  overflow: visible;
}

pre.r::before {
  content: 'In [' counter(counter-rchunks) ']: ';
  display: inline-block;
  position: absolute;
  left: -5em;
  color: rgb(48, 63, 159);
}
```

## 1. Introduction about company Bellaheart

Established in 2013, Bellabeat is a pioneering company specialising in health and wellness tracking devices tailored for women. Renowned for its flagship product, the Bellabeat Leaf, the company offers stylish fitness trackers designed to monitor various aspects of women’s health, including activity levels, sleep patterns, stress levels, and menstrual cycles. With a mission to empower women through innovative, tech-driven solutions, Bellabeat is at the forefront of revolutionising the health and wellness industry. For the latest updates and product offerings, visit the official Bellabeat website [Here](https://bellabeat.com/).

## 2. Current trends

##### 2.1. Health Monitoring Advancements:
In recent years, smart fitness devices have evolved to incorporate advanced health monitoring features such as comprehensive sleep analysis, stress tracking capabilities, and real-time monitoring of blood oxygen saturation levels.

##### 2.2. Personalization and AI Integration:
Artificial intelligence (AI) algorithms are increasingly driving personalisation in health and wellness devices. These algorithms offer tailored insights and recommendations based on users’ individual health data, enhancing the overall user experience and engagement.

##### 2.3. Ecosystem Integration:
There is a growing trend towards ecosystem integration, with fitness devices seamlessly connecting with various health platforms, mobile apps, and smart home devices. This integration enhances the overall user experience by providing a more holistic approach to health and wellness management.

## 3. Questions for the analysis

* What are the emerging trends in smart device usage, and how do they impact the health and wellness industry?
* How can these trends be applied to better serve Bellabeat's customer base?
* How can insights from these trends inform Bellabeat's marketing strategy to effectively reach and engage with target audiences?

## 4. Business task

Bellabeat's primary objective is to drive sales revenue growth and expand market coverage by implementing a strategic plan aimed at targeting new customer segments and strengthening the brand's presence in existing markets.

## 5. Loading package
```{r}
library(tidyverse)
library(lubridate)
library(dplyr)
library(ggplot2)
library(tidyr)
```

## 6. Importing datasets

I will be using the data frames from  [FitBit Fitness Tracker Data](https://www.kaggle.com/datasets/arashnic/fitbit/data),  which was generated by respondents who participated in a distributed survey via Amazon Mechanical Turk between April 12, 2016, and May 12, 2016:

```{r cars2}
Activity <- read.csv("../project/mturkfitbit_export_4.12.16-5.12.16/Fitabase Data 4.12.16-5.12.16/dailyActivity_merged.csv")
Sleep <- read.csv("../project/mturkfitbit_export_4.12.16-5.12.16/Fitabase Data 4.12.16-5.12.16/sleepDay_merged.csv")
H_Calories <- read.csv("../project/mturkfitbit_export_4.12.16-5.12.16/Fitabase Data 4.12.16-5.12.16/hourlyCalories_merged.csv")
H_Intensities <- read.csv("../project/mturkfitbit_export_4.12.16-5.12.16/Fitabase Data 4.12.16-5.12.16/hourlyIntensities_merged.csv")
H_Steps <- read.csv("../project/mturkfitbit_export_4.12.16-5.12.16/Fitabase Data 4.12.16-5.12.16/hourlySteps_merged.csv")
```

## 7. Cleaning and formatting

Before analysing the data, I identified some formatting issues with the timestamp data. I need to align the format and split it into date and time:

```{r cars3}
# Sleep
# Convert the 'SleepDay' column to Date object
Sleep$SleepDay <- as.Date(Sleep$SleepDay, format = '%m/%d/%Y %I:%M:%S %p')
# Format the 'SleepDay' column to desired format
Sleep$SleepDay <- format(Sleep$SleepDay, '%m/%d/%Y')
# Rename the column 'SleepDay' to 'Date'
Sleep <- Sleep %>%
  rename(Date = SleepDay)

# Activity
# Rename the columns 'ModeratelyActiveDistance' to 'FairlyActiveDistance' and 'ActivityDate' to 'Date'
Activity <- Activity %>%
  rename(FairlyActiveDistance = ModeratelyActiveDistance,
         Date = ActivityDate)
# Format the 'Date' column to desired format
Activity$Date <- format(as.Date(Activity$Date, "%m/%d/%Y"), "%m/%d/%Y")

# H_Calories
# Split 'ActivityHour' into date and time columns
H_Calories$Date <- as.Date(H_Calories$ActivityHour, format = '%m/%d/%Y %I:%M:%S %p')
H_Calories$Time <- format(as.POSIXct(H_Calories$ActivityHour, format = '%m/%d/%Y %I:%M:%S %p'), format = '%H:%M:%S')
# Remove the original 'ActivityHour' column if needed
H_Calories <- subset(H_Calories, select = -c(ActivityHour))
# Format the 'Date' column to desired format
H_Calories$Date <- format(H_Calories$Date, '%m/%d/%Y')

# H_Intensities
# Split 'ActivityHour' into date and time columns
H_Intensities$Date <- as.Date(H_Intensities$ActivityHour, format = '%m/%d/%Y %I:%M:%S %p')
H_Intensities$Time <- format(as.POSIXct(H_Intensities$ActivityHour, format = '%m/%d/%Y %I:%M:%S %p'), format = '%H:%M:%S')
# Remove the original 'ActivityHour' column if needed
H_Intensities <- H_Intensities[, !names(H_Intensities) %in% "ActivityHour"]
# Format the 'Date' column to desired format
H_Intensities$Date <- format(H_Intensities$Date, '%m/%d/%Y')

# H_Steps
# Split 'ActivityHour' into date and time columns
H_Steps$Date <- as.Date(H_Steps$ActivityHour, format = '%m/%d/%Y %I:%M:%S %p')
H_Steps$Time <- format(as.POSIXct(H_Steps$ActivityHour, format = '%m/%d/%Y %I:%M:%S %p'), format = '%H:%M:%S')
# Remove the original 'ActivityHour' column if needed
H_Steps <- subset(H_Steps, select = -c(ActivityHour))
# Format the 'Date' column to desired format
H_Steps$Date <- format(H_Steps$Date, '%m/%d/%Y')

```

Right now, I have total five data frames, for 'Activity' and 'Sleep' are recorded by date. For 'H_Calories', 'H_Intensities' and 'H_Steps' are recorded by hour. 

Firstly, let's determine the number of unique IDs in each data frame:

```{r cars4, results = FALSE}
n_distinct(Activity$Id)
n_distinct(Sleep$Id)
n_distinct(H_Calories$Id)
n_distinct(H_Intensities$Id)
n_distinct(H_Steps$Id)
```

33

24

33

33

33

There are 33 unique IDs in the 'Activity', 'H_Calories', 'H_Intensities', and 'H_Steps' data frames, while 'Sleep' contains 24 unique IDs.


Next, I'll check if there is any duplicate rows within the data frames:
```{r cars5, results = FALSE}
sum(duplicated(Activity))
sum(duplicated(Sleep))
sum(duplicated(H_Calories))
sum(duplicated(H_Intensities))
sum(duplicated(H_Steps))
```

0

3

0

0

0

I need to remove the duplicates in data frame 'Sleep':

```{r cars6}
# Find duplicate rows of Sleep
duplicate_rows <- duplicated(Sleep)
# Remove duplicate rows of Sleep
Sleep <- Sleep[!duplicate_rows, ]
```

Now, I aim to merge the data frames 'H_Calories', 'H_Intensities', and 'H_Steps' into a new data frame called 'H_Activity'. Before merging, it's crucial to ensure that the columns 'Id', 'Date', and 'Time' are identical in all three data frames:

```{r cars7}
if(identical(H_Calories$Id, H_Intensities$Id) && identical(H_Calories$Id, H_Steps$Id)) {
  print("Columns 'Id' are identical in all three tables")
} else {
  print("Columns 'Id' are not identical in all three tables")
}
if(identical(H_Calories$Date, H_Intensities$Date) && identical(H_Calories$Date, H_Steps$Date)) {
  print("Columns 'Date' are identical in all three tables")
} else {
  print("Columns 'Date' are not identical in all three tables")
}
if(identical(H_Calories$Time, H_Intensities$Time) && identical(H_Calories$Time, H_Steps$Time)) {
  print("Columns 'Time' are identical in all three tables")
} else {
  print("Columns 'Time' are not identical in all three tables")
}
```

## 8.Merging data

I'll merge multiple data frames 'H_Calories', 'H_Intensities', and 'H_Steps' into a new single table 'H_Activity'. I aim to create a unified data frame for comprehensive analysis. Let's proceed with the merging process:

```{r cars8}
H_Activity <- merge(merge(H_Calories, H_Intensities, by = c("Id", "Date", "Time"), all = TRUE), H_Steps, by = c("Id", "Date", "Time"), all = TRUE)
head(H_Activity)
```

Additionally, I'll merge the 'Activity' and 'Sleep' data frames into a new table called 'D_Sleep', focusing on columns related to 'Sleep' metrics. Considering the 'Sleep' data frame has only 24 unique 'Id' sets (compared to 33 in 'Activity'), I'll exclude any rows with missing values from 'Sleep'. Let's proceed with the merging process:

```{r cars9}
D_Sleep <- merge(Activity, Sleep, by = c("Id", "Date"), all = TRUE) %>%
  select(Id, Date, TotalSteps, TotalDistance, Calories, TotalMinutesAsleep)%>%
  na.omit()
head(D_Sleep)
```

## 9.Analyse and visualise the data

To gain insights from the 'Activity' data frame, I'll group the data by unique user IDs and calculate totals and averages:

```{r cars10}
S_Activity <- Activity %>%
  group_by(Id) %>%
  summarise(
    S_TotalSteps = sum(TotalSteps, na.rm = TRUE),
    S_TotalDistance = sum(TotalDistance, na.rm = TRUE),
    S_VeryActiveDistance = sum(VeryActiveDistance, na.rm = TRUE),
    S_FairlyActiveDistance = sum(FairlyActiveDistance, na.rm = TRUE),
    S_LightActiveDistance = sum(LightActiveDistance, na.rm = TRUE),
    S_VeryActiveMinutes = sum(VeryActiveMinutes, na.rm = TRUE),
    S_FairlyActiveMinutes = sum(FairlyActiveMinutes, na.rm = TRUE),
    S_LightlyActiveMinutes = sum(LightlyActiveMinutes, na.rm = TRUE),
    S_TotalActiveMinutes = sum(VeryActiveMinutes + FairlyActiveMinutes + LightlyActiveMinutes , na.rm = TRUE),
    S_Calories = sum(Calories, na.rm = TRUE)
  )
Avg_Activity <- Activity %>%
  group_by(Id) %>%
  summarise(
    Avg_TotalSteps = mean(TotalSteps, na.rm = TRUE),
    Avg_TotalDistance = mean(TotalDistance, na.rm = TRUE),
    Avg_VeryActiveDistance = mean(VeryActiveDistance, na.rm = TRUE),
    Avg_FairlyActiveDistance = mean(FairlyActiveDistance, na.rm = TRUE),
    Avg_LightActiveDistance = mean(LightActiveDistance, na.rm = TRUE),
    Avg_VeryActiveMinutes = mean(VeryActiveMinutes, na.rm = TRUE),
    Avg_FairlyActiveMinutes = mean(FairlyActiveMinutes, na.rm = TRUE),
    Avg_LightlyActiveMinutes = mean(LightlyActiveMinutes, na.rm = TRUE),
    Avg_Calories = mean(Calories, na.rm = TRUE)
  )

head(S_Activity)
head(Avg_Activity)
```

I'd like to visualize the percentage of 'Very Active Distance', 'Fairly Active Distance' and 'Light Active Distance' in data frame S_Activity with pie chart:

```{r pressure1}
# Calculate the proportions
proportions <- S_Activity %>%
  summarise(
    VeryActive = sum(S_VeryActiveDistance) / sum(S_TotalDistance) * 100,
    FairlyActive = sum(S_FairlyActiveDistance) / sum(S_TotalDistance) * 100,
    LightActive = sum(S_LightActiveDistance) / sum(S_TotalDistance) * 100,
  ) %>%
  gather(ActivityType, Percentage)

# Create pie chart with percentage labels inside slices
ggplot(proportions, aes(x = "", y = Percentage, fill = ActivityType)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  geom_text(aes(label = paste0(round(Percentage), "%")), 
            position = position_stack(vjust = 0.5), 
            color = "white", size = 5) +
  coord_polar("y", start = 0) +
  scale_fill_manual(values = c("#0072B2", "#009E73", "#D55E00")) +
  labs(title = "Percentage Distribution of Activity Distance",
       fill = "Activity Type",
       x = NULL,
       y = NULL) +
  theme_void() +
  theme(legend.position = "right",
        plot.title = element_text(size = 16, hjust = 0.5, color = "black"),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 16),
        axis.text = element_blank(),
        axis.title = element_blank())
```

* After analyzing the S_Activity table, it's evident that the distribution of activity levels varies significantly. Very Active distance accounts for approximately 27% of the total distance covered, indicating a notable portion of high-intensity activities. Fairly Active distance constitutes about 10% of the total distance, suggesting moderate activity levels. In contrast, Light Active distance makes up the majority, comprising approximately 61% of the total distance. 
* This indicates a substantial portion of low-intensity activities within the dataset.

Next, I'd like to visualize the percentage between 'Very Active Minutes', 'Fairly Active Minutes' and 'Lightly Active Minutes' in data frame S_Activity with pie chart:

```{r pressure2, echo=FALSE}
# Calculate the proportions
proportions <- S_Activity %>%
  summarise(
    VeryActive = sum(S_VeryActiveMinutes) / sum(S_TotalActiveMinutes) * 100,
    FairlyActive = sum(S_FairlyActiveMinutes) / sum(S_TotalActiveMinutes) * 100,
    LightActive = sum(S_LightlyActiveMinutes) / sum(S_TotalActiveMinutes) * 100,
  ) %>%
  gather(ActivityType, Percentage)

# Create pie chart with percentage labels inside slices
ggplot(proportions, aes(x = "", y = Percentage, fill = ActivityType)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  geom_text(aes(label = paste0(round(Percentage), "%")), 
            position = position_stack(vjust = 0.5), 
            color = "white", size = 5) +
  coord_polar("y", start = 0) +
  scale_fill_manual(values = c("#0072B2", "#009E73", "#D55E00")) +
  labs(title = "Percentage Distribution of Activity Time",
       fill = "Activity Type",
       x = NULL,
       y = NULL) +
  theme_void() +
  theme(legend.position = "right",
        plot.title = element_text(size = 16, hjust = 0.5, color = "black"),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 16),
        axis.text = element_blank(),
        axis.title = element_blank())
```

* It shows that the majority of activity falls into the 'Light Active' category, constituting 85% of the total. 'Very Active' and 'Fairly Active' minutes contribute 9% and 6% respectively, indicating a smaller portion of the overall activity levels.

Based on the analysis of the S_Activity table and the two pie charts:

* Both pie charts show that 'Light Active' activities dominate, followed by 'Very Active' and 'Fairly Active' activities.
* However, when considering activity minutes, the skew towards 'Light Active' minutes is more pronounced.
* These findings underscore the significance of low-intensity activities in the dataset, suggesting a widespread focus on activities like walking or light exercise.

Let's explore how calories expenditure varies throughout the day:

```{r pressure3}
# Convert 'Time' column to numeric format
H_Activity$Time <- as.numeric(substr(H_Activity$Time, 1, 2))  # Assuming the time is in HH:MM:SS format

# Calculate the average calories by time
calories_by_time <- H_Activity %>%
  group_by(Time) %>%
  summarise(Avg_Calories = mean(Calories))

# Plot a bar chart of average calories over time
ggplot(calories_by_time, aes(x = Time, y = Avg_Calories, fill = Avg_Calories)) +
  geom_bar(stat = "identity") +
  geom_hline(yintercept = 100, linetype = "dashed", color = "red") + # Add horizontal line at 100
  scale_fill_gradient(low = "#009E73", high = "#D55E00") + # Gradient fill for bars
  labs(title = "Average Calories Over Time", x = "Time", y = "Average Calories") +
  theme(legend.position = "top", axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(plot.title = element_text(size = 16, hjust = 0.5, color = "black"))
```

* This reveals that peak calorie expenditure occurs between 8 am and 7 pm, indicating heightened activity levels during these hours.
* More specifically, the time frames from 12 pm to 2 pm and from 5 pm to 7 pm show the highest calorie expenditure. This suggests that individuals may engage in physical activities such as going to the gym or taking walks during lunchtime and after work hours.

Right now, I need to visualize the relationship between 'TotalDistance' and 'Calories' per 'Id' in the 'S_Activity' table:

```{r pressure4}
ggplot(S_Activity, aes(x = S_TotalDistance, y = S_Calories)) +
  geom_jitter(width = 0.2, height = 0.2) + 
  geom_smooth(method = "loess", se = FALSE, color = "#0072B2") + 
  labs(title = "Relationship between Total Distance and Calories per Id",
       x = "Total Distace(Km)", y = "Calories") + 
  theme_minimal()+
  theme(plot.title = element_text(size = 16, hjust = 0.5, color = "black"))
```

* There's a clear positive correlation observed between 'Total Distance' and 'Calories', which is expected. As activity levels increase, so does the calories expenditure, as anticipated.

Finally, I'd like to explore the relationship between daily walking distance and daily sleep minutes to see if there's any correlation:

```{r pressure5}
ggplot(D_Sleep, aes(x = TotalDistance, y = TotalMinutesAsleep)) +
  geom_jitter(width = 0.2, height = 0.2) +  # Add jitter to avoid overlapping points
  geom_smooth(method = "loess", se = FALSE, color = "#0072B2") +  # Add a smooth line
  labs(title = "Relation between Total Distance and Total Minutes Asleep",
       x = "Total Distance (Km)", y = "Total Minutes Asleep") +
  theme_minimal() +
  theme(plot.title = element_text(size = 16, hjust = 0.5, color = "black"))
```

* I expected to find a positive correlation in the results. However, the data indicates that there is no correlation between daily walking distance and the amount of daily sleep minutes.

## 10.Summary of Recommendations for Bellabeat:


Based on the analysis and the current, here are some recommendations for Bellabeat:

**Design for the Female Professionals:** Focus on designing fitness trackers that appeal to the aesthetic preferences of female professionals. These devices should feature a light, trendy, and fashionable design, with a variety of colour options available. They should seamlessly integrate into office attire, allowing users to wear them throughout the day without compromising style.

**Enhanced Sleep Monitoring:** Given the importance of sleep for overall health and well-being, Bellabeat should prioritize the sleep monitoring feature in its devices. This includes providing comprehensive sleep analysis, tracking sleep patterns, and offering personalized recommendations for improving sleep quality.

**Daily Calories Recommendations:** Provide daily recommendations tailored to each user's individual needs. This includes personalized goals for calories intake and expenditure, as well as recommendations for healthy food choices based on the user's activity level and fitness goals. This is particularly important for female professionals who may have limited time to plan meals and fitness routines.

**Focus on Essential Features:** Instead of overwhelming users with advanced features, prioritize essential functionalities that align with the needs and preferences of female professionals. This includes features related to activity tracking, sleep monitoring, and personalized health recommendations.

**Utilize AI for Personalization:** Leverage artificial intelligence (AI) algorithms to enhance personalization in health and wellness devices. By analyzing users' individual health data, AI can provide tailored insights and recommendations, improving user engagement and satisfaction.

**Enhance Ecosystem Integration:** Integrate fitness devices with various health platforms, mobile apps, and smart home devices to create a seamless user experience. This ecosystem integration will enable users to access a holistic approach to health and wellness management, further distinguishing Bellabeat's products in the market.
